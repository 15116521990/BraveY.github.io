<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16x16.png">
  <link rel="mask-icon" href="/images/favicon16x16.png" color="#222">
  <meta name="google-site-verification" content="hDujO4MQUB7U9ir-4VXM5PW4fDFSq0-7G-LBX-Lh86M">
  <meta name="baidu-site-verification" content="8XIUcPkbzm">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="今日事，今日毕">
<meta property="og:type" content="website">
<meta property="og:title" content="BraveY">
<meta property="og:url" content="https://bravey.github.io/index.html">
<meta property="og:site_name" content="BraveY">
<meta property="og:description" content="今日事，今日毕">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="BraveY">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://bravey.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>BraveY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BraveY</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-26-Kaggle%E7%8C%AB%E7%8B%97%E8%AF%86%E5%88%ABPytorch%E8%AF%A6%E7%BB%86%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-26-Kaggle%E7%8C%AB%E7%8B%97%E8%AF%86%E5%88%ABPytorch%E8%AF%A6%E7%BB%86%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B.html" class="post-title-link" itemprop="url">Kaggle猫狗识别Pytorch详细搭建过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-26 13:02:42 / 修改时间：14:14:32" itemprop="dateCreated datePublished" datetime="2020-04-26T13:02:42+08:00">2020-04-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-26-Kaggle%E7%8C%AB%E7%8B%97%E8%AF%86%E5%88%ABPytorch%E8%AF%A6%E7%BB%86%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B.html" class="post-meta-item leancloud_visitors" data-flag-title="Kaggle猫狗识别Pytorch详细搭建过程" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-26-Kaggle%E7%8C%AB%E7%8B%97%E8%AF%86%E5%88%ABPytorch%E8%AF%A6%E7%BB%86%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-26-Kaggle猫狗识别Pytorch详细搭建过程.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://github.com/BraveY/AI-with-code/tree/master/dog-vs-cat" target="_blank" rel="noopener">文章源码链接</a>，包括Notebook和对应的Pycharm项目。求个Star！！</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p><a href="https://www.kaggle.com/c/dogs-vs-cats-redux-kernels-edition?rvi=1" target="_blank" rel="noopener">Kaggle比赛链接</a> ,给出猫狗图片，然后预测图片中是狗的概率。</p>
<p>训练集有25,000张图片，测试集12,500 张图片。</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587879395/blog/deep-learning/CatAndDog.jpg" alt=""></p>
<p>自己最开始构思大致框架的时候的一个思维导图：</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587879936/blog/deep-learning/CatAndDog_xmid.jpg" alt=""></p>
<h2 id="包的导入"><a href="#包的导入" class="headerlink" title="包的导入"></a>包的导入</h2><p>需要注意的是将tqdm 改为tqdm.notebook，从而在notebook环境下获得更好的体验。因为导入tqdm的话，会发生进度条打印多次的情况，体验很不好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms,models,utils</span><br><span class="line"><span class="keyword">from</span> tqdm.notebook <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="comment"># from tqdm import tqdm_notebook as tqdm</span></span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter </span><br><span class="line"><span class="comment"># from torchvision import datasets, transforms,utils</span></span><br></pre></td></tr></table></figure>
<p>相关文件路径配置，在pycharm项目中将相关路径的配置都统一放在config.py中来管理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">train_path = <span class="string">'D:/AIdata/dog vs cat/train'</span></span><br><span class="line">test_path = <span class="string">'D:/AIdata/dog vs cat/test1'</span></span><br><span class="line">data_root = <span class="string">'D:/AIdata/dog vs cat/'</span></span><br><span class="line">csv_path = <span class="string">'./submission_valnet.csv'</span></span><br><span class="line">tensorboard_path=<span class="string">'C:/Users/BraveY/Documents/BraveY/AI-with-code/dog-vs-cat/tensortboard'</span></span><br><span class="line">model_save_path = <span class="string">'C:/Users/BraveY/Documents/BraveY/AI-with-code/dog-vs-cat/modelDict/dogs-vs-cats-notebook.pth'</span></span><br></pre></td></tr></table></figure>
<h2 id="数据集的创建"><a href="#数据集的创建" class="headerlink" title="数据集的创建"></a>数据集的创建</h2><p>因为Kaggle官方提供的是<a href="https://www.kaggle.com/c/dogs-vs-cats-redux-kernels-edition/data" target="_blank" rel="noopener">原始数据</a>，不像之前的手写数字数据集可以从pytorch中直接下载已经处理过的数据集，可以直接将数据放入模型进行训练。因此需要我们自己实现数据集的生成。</p>
<p>数据集生成的总体思路是继承torch.utils.data.Dataset这个类，自己实现<strong>getitem</strong>和<strong>len</strong>这两个私有方法来完成对我们自己数据的读取操作。其中<strong>getitem</strong>这个函数的主要功能是根据样本的索引，返回索引对应的一张图片的图像数据X与对应的标签Y，也就是返回一个对应的训练样本。<strong>len</strong>这个函数的功能比较简单直接返回数据集中样本的个数即可。</p>
<p>具体而言，<strong>getitem</strong>的实现思路比较简单，将索引idx转换为图片的路径，然后用PIL的Image包来读取图片数据，然后将数据用torchvision的transforms转换成tensor并且进行Resize来统一大小（给出的图片尺寸不一致）与归一化，这样一来就可以得到图像数据了。因为训练集中图片的文件名上面带有猫狗的标签，所以标签可以通过对图片文件名split后得到然后转成0,1编码。</p>
<p>在获取标签的时候，因为官方提供的测试数据集中并没有猫狗的标签，所以测试集的标签逻辑稍有不同。我的做法是使用一个train标志来进行区分，对于测试的数据，直接将测试样本的标签变成图片自带的id，这样方便后面输出提交的csv文件。因为测试样本不用计算loss，所以将标签置为id是没问题的。</p>
<p>为了实现将idx索引转换成图片路径，需要在<strong>init</strong>()函数中将所有的图片路径放在一个list中，这可以用os.listdir()来实现，然后就可以根据索引去获得路径了。</p>
<p>需要注意的是，之所以<strong>getitem</strong>()需要根据索引来返回样本，是因为训练数据并不是一次性将所有样本数据加载到内存中，这样太耗内存。而是只用加载对应batch中的一部分数据，所以通过索引来加载送入模型中的一批数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data_path:str, train=True, transform=None)</span>:</span></span><br><span class="line">        self.data_path = data_path</span><br><span class="line">        self.train_flag = train</span><br><span class="line">        <span class="keyword">if</span> transform <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.transform = transforms.Compose(</span><br><span class="line">            [</span><br><span class="line">                transforms.Resize(size = (<span class="number">224</span>,<span class="number">224</span>)),<span class="comment">#尺寸规范</span></span><br><span class="line">                transforms.ToTensor(),   <span class="comment">#转化为tensor</span></span><br><span class="line">                transforms.Normalize((<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>), (<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>)),</span><br><span class="line">            ])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.transform = transform</span><br><span class="line">        self.path_list = os.listdir(data_path)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx: int)</span>:</span></span><br><span class="line">        <span class="comment"># img to tensor and label to tensor</span></span><br><span class="line">        img_path = self.path_list[idx]</span><br><span class="line">        <span class="keyword">if</span> self.train_flag <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> img_path.split(<span class="string">'.'</span>)[<span class="number">0</span>] == <span class="string">'dog'</span> : </span><br><span class="line">                label = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            label = int(img_path.split(<span class="string">'.'</span>)[<span class="number">0</span>]) <span class="comment"># split 的是str类型要转换为int</span></span><br><span class="line">        label = torch.as_tensor(label, dtype=torch.int64) <span class="comment"># 必须使用long 类型数据，否则后面训练会报错 expect long</span></span><br><span class="line">        img_path = os.path.join(self.data_path, img_path)</span><br><span class="line">        img = Image.open(img_path)</span><br><span class="line">        img = self.transform(img)</span><br><span class="line">        <span class="keyword">return</span> img, label</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.path_list)</span><br></pre></td></tr></table></figure>
<p>测试一下，确保Dataset可以正常迭代</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">train_ds = MyDataset(train_path)</span><br><span class="line">test_ds = MyDataset(test_path,train=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(tqdm(train_ds)):</span><br><span class="line"><span class="comment">#     pass</span></span><br><span class="line">    print(item)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<pre><code>(tensor([[[ 0.5922,  0.6078,  0.6392,  ...,  0.9216,  0.8902,  0.8745],
         [ 0.5922,  0.6078,  0.6392,  ...,  0.9216,  0.8980,  0.8824],
         [ 0.5922,  0.6078,  0.6392,  ...,  0.9216,  0.9059,  0.8902],
         ...,
         [ 0.2078,  0.2157,  0.2235,  ..., -0.9765, -0.9765, -0.9765],
         [ 0.2000,  0.2000,  0.2078,  ..., -0.9843, -0.9843, -0.9843],
         [ 0.1843,  0.1922,  0.2000,  ..., -0.9922, -0.9922, -0.9922]],

        [[ 0.2863,  0.3020,  0.3333,  ...,  0.6000,  0.5843,  0.5686],
         [ 0.2863,  0.3020,  0.3333,  ...,  0.6000,  0.5922,  0.5765],
         [ 0.2863,  0.3020,  0.3333,  ...,  0.6000,  0.6000,  0.5843],
         ...,
         [-0.0353, -0.0275, -0.0196,  ..., -0.9765, -0.9765, -0.9765],
         [-0.0431, -0.0431, -0.0353,  ..., -0.9843, -0.9843, -0.9843],
         [-0.0588, -0.0510, -0.0431,  ..., -0.9922, -0.9922, -0.9922]],

        [[-0.3176, -0.3020, -0.2706,  ..., -0.0588, -0.0431, -0.0510],
         [-0.3176, -0.3020, -0.2706,  ..., -0.0510, -0.0431, -0.0431],
         [-0.3176, -0.3020, -0.2706,  ..., -0.0431, -0.0275, -0.0353],
         ...,
         [-0.5608, -0.5529, -0.5451,  ..., -0.9922, -0.9922, -0.9922],
         [-0.5686, -0.5686, -0.5608,  ..., -1.0000, -1.0000, -1.0000],
         [-0.5843, -0.5765, -0.5686,  ..., -1.0000, -1.0000, -1.0000]]]), tensor(0))
</code></pre><h2 id="数据集划分"><a href="#数据集划分" class="headerlink" title="数据集划分"></a>数据集划分</h2><p>如前面所述，因为官方测试集没有标签，而且提交结果上去后只有一个log loos来作为分值，没有准确率的结果。所以为了得到准确率这个指标，需要新建个有标签的验证集来查看准确率。</p>
<p>实现思路是使用torch.utils.data.random_split(),来将官方提供训练数据集划分出一部分的验证集。我的比例是80%的训练集，20%的验证集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">full_ds = train_ds</span><br><span class="line">train_size = int(<span class="number">0.8</span> * len(full_ds))</span><br><span class="line">validate_size = len(full_ds) - train_size</span><br><span class="line">new_train_ds, validate_ds = torch.utils.data.random_split(full_ds,[train_size, validate_size])<span class="comment">#数据集划分</span></span><br></pre></td></tr></table></figure>
<h2 id="数据加载"><a href="#数据加载" class="headerlink" title="数据加载"></a>数据加载</h2><p>我们制作的数据集并不能直接放入模型进行训练，还需要使用一个数据加载器，来加载数据集。使用torch.utils.data.DataLoader()来划分每个batch用来后面训练的时候向网络提供输入数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">train_loader = torch.utils.data.DataLoader(train_ds, batch_size=<span class="number">32</span>,</span><br><span class="line">                                            shuffle=<span class="literal">True</span>, pin_memory=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line">test_loader = torch.utils.data.DataLoader(test_ds, batch_size=<span class="number">32</span>,</span><br><span class="line">                                            shuffle=<span class="literal">True</span>, pin_memory=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line"><span class="comment">## numworkers设置不为0 会报错 Broken pipe Error 网上说是win10上的pytorch bug</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new_train_loader = torch.utils.data.DataLoader(train_ds, batch_size=<span class="number">32</span>,</span><br><span class="line">                                            shuffle=<span class="literal">True</span>, pin_memory=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line">validate_loader = torch.utils.data.DataLoader(validate_ds, batch_size=<span class="number">32</span>,</span><br><span class="line">                                            shuffle=<span class="literal">True</span>, pin_memory=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>加载过后数据形状从三维变成四维，多的维度是batch_size，这里是32个样本构成一个batch</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(train_loader):</span><br><span class="line"><span class="comment">#     pass</span></span><br><span class="line">    print(item[<span class="number">0</span>].shape)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<pre><code>torch.Size([32, 3, 224, 224])
</code></pre><h3 id="resize后的图像查看"><a href="#resize后的图像查看" class="headerlink" title="resize后的图像查看"></a>resize后的图像查看</h3><p>前面提到过对数据进行了resize和正则化的处理，下面是对处理后的图像的可视化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">img_PIL_Tensor = train_ds[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">new_img_PIL = transforms.ToPILImage()(img_PIL_Tensor).convert(<span class="string">'RGB'</span>)</span><br><span class="line">plt.imshow(new_img_PIL)</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment"># print(new_img_PIL.show())</span></span><br></pre></td></tr></table></figure>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587879395/blog/deep-learning/output_16_0.png" alt="png"></p>
<p>​<br>​    </p>
<h2 id="网络搭建"><a href="#网络搭建" class="headerlink" title="网络搭建"></a>网络搭建</h2><p>网络搭建的框架与之前的<a href="https://zhuanlan.zhihu.com/p/112829371" target="_blank" rel="noopener">手写数字识别</a>的框架一致，两个卷积层后3个全连接层。需要注意的是参数不能套用之前的参数了，因为之前的手写数字的图片很小，而且数据量不大所以尽管参数比较大，也能在我的机子上跑起来(MX150,2GB显存)。猫狗的数据量显然比之前的大，所以需要将参数变小些，才能跑起来。 我实验了下，如果不将网络参数降低的话，只调整batch_size没有用，依然会报显存不足。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(MyCNN,self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">3</span>,<span class="number">8</span>,kernel_size=<span class="number">3</span>,stride=<span class="number">1</span>,padding=<span class="number">1</span>) <span class="comment"># 按照公式计算后经过卷积层不改变尺寸</span></span><br><span class="line">        self.pool = nn.MaxPool2d(<span class="number">2</span>,<span class="number">2</span>) <span class="comment"># 2*2的池化 池化后size 减半</span></span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">8</span>,<span class="number">16</span>,kernel_size=<span class="number">3</span>,stride=<span class="number">1</span>,padding=<span class="number">1</span>)</span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">16</span>*<span class="number">56</span>*<span class="number">56</span>,<span class="number">256</span>)<span class="comment">#两个池化，所以是224/2/2=56</span></span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">256</span>,<span class="number">64</span>)</span><br><span class="line">        self.fc3 = nn.Linear(<span class="number">64</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">#         self.dp = nn.Dropout(p=0.5)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line"><span class="comment">#         print("input:", x)</span></span><br><span class="line">        x = self.pool(F.relu(self.conv1(x)))</span><br><span class="line"><span class="comment">#         print("first conv:", x)</span></span><br><span class="line">        x = self.pool(F.relu(self.conv2(x)))</span><br><span class="line"><span class="comment">#         print("second conv:", x)</span></span><br><span class="line">             </span><br><span class="line">        x = x.view(<span class="number">-1</span>, <span class="number">16</span> * <span class="number">56</span>* <span class="number">56</span>)<span class="comment">#将数据平整为一维的 </span></span><br><span class="line">        x = F.relu(self.fc1(x))</span><br><span class="line">        x = F.relu(self.fc2(x))  </span><br><span class="line">        x = self.fc3(x)  </span><br><span class="line"><span class="comment">#         x = F.log_softmax(x,dim=1) NLLLoss()才需要，交叉熵不需要</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<h3 id="预训练模型"><a href="#预训练模型" class="headerlink" title="预训练模型"></a>预训练模型</h3><p>除了自己手动DIY一个网络，也可以使用Pytorch已经提供的一些性能很好的模型比如VGG16，ResNet50等等，然后微调下网络结构，来得到符合自己的任务的网络架构。还可以直接下载这些模型在ImageNet上的预训练参数，然后在自己的数据集上进行训练。</p>
<p>我在这儿选择了ResNet50网络以及预训练好的权重进行了下实验，我在实验室的机器上面用P100跑的，因为自己的笔记本显卡太垃圾了只有2GB显存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 直接设置为True的话下载权重太慢了</span></span><br><span class="line"><span class="comment">## 所以手动用浏览器下载好了之后再重新加载</span></span><br><span class="line">resnet50 = models.resnet50(pretrained=<span class="literal">False</span>)  </span><br><span class="line">model_path = <span class="string">'D:/AIdata/dog vs cat/resnet50-19c8e357.pth'</span></span><br><span class="line">resnet50.load_state_dict(torch.load(model_path))</span><br><span class="line">resnet50.fc = nn.Linear(<span class="number">2048</span>, <span class="number">2</span>) <span class="comment">#修改最后一层网络将输出调整为两维</span></span><br></pre></td></tr></table></figure>
<h2 id="损失函数和优化函数"><a href="#损失函数和优化函数" class="headerlink" title="损失函数和优化函数"></a>损失函数和优化函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net = MyCNN()</span><br><span class="line"><span class="comment"># net = resnet50</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line"><span class="comment"># criterion = nn.BCELoss()  #二分类交叉熵损失函数</span></span><br><span class="line"><span class="comment"># criterion = nn.BCEWithLogitsLoss() #二分类交叉熵损失函数 带log loss</span></span><br><span class="line"><span class="comment"># criterion = nn.MSELoss()</span></span><br><span class="line"></span><br><span class="line">optimizer = optim.SGD(net.parameters(), lr=<span class="number">0.001</span>, momentum=<span class="number">0.9</span>)</span><br><span class="line"><span class="comment">#也可以选择Adam优化方法</span></span><br><span class="line"><span class="comment"># optimizer = torch.optim.Adam(net.parameters(),lr=1e-2)</span></span><br></pre></td></tr></table></figure>
<h2 id="训练日志的打印"><a href="#训练日志的打印" class="headerlink" title="训练日志的打印"></a>训练日志的打印</h2><p>在之前的手写数字识别的准确率的计算和画图以日志的打印比较简单，在这更新为topk准确率以及使用tensorboard来画曲线。并且使用tqdm进度条来实时的打印日志。</p>
<p>专门建立一个类来保存和更新准确率的结果，使用类来让代码更加的规范化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvgrageMeter</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.reset()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.avg = <span class="number">0</span></span><br><span class="line">        self.sum = <span class="number">0</span></span><br><span class="line">        self.cnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, val, n=<span class="number">1</span>)</span>:</span></span><br><span class="line">        self.sum += val * n</span><br><span class="line">        self.cnt += n</span><br><span class="line">        self.avg = self.sum / self.cnt</span><br></pre></td></tr></table></figure>
<h2 id="准确率的计算"><a href="#准确率的计算" class="headerlink" title="准确率的计算"></a>准确率的计算</h2><p>torch.topk(input, k, dim=None, largest=True, sorted=True, out=None) -&gt; (Tensor, LongTensor) 返回某一维度前k个的索引<br>input：一个tensor数据<br>k：指明是得到前k个数据以及其index<br>dim： 指定在哪个维度上排序， 默认是最后一个维度<br>largest：如果为True，按照大到小排序； 如果为False，按照小到大排序<br>sorted：返回的结果按照顺序返回<br>out：可缺省，不要</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## topk的准确率计算</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">accuracy</span><span class="params">(output, label, topk=<span class="params">(<span class="number">1</span>,)</span>)</span>:</span></span><br><span class="line">    maxk = max(topk) </span><br><span class="line">    batch_size = label.size(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取前K的索引</span></span><br><span class="line">    _, pred = output.topk(maxk, <span class="number">1</span>, <span class="literal">True</span>, <span class="literal">True</span>) <span class="comment">#使用topk来获得前k个的索引</span></span><br><span class="line">    pred = pred.t() <span class="comment"># 进行转置</span></span><br><span class="line">    <span class="comment"># eq按照对应元素进行比较 view(1,-1) 自动转换到行为1,的形状， expand_as(pred) 扩展到pred的shape</span></span><br><span class="line">    <span class="comment"># expand_as 执行按行复制来扩展，要保证列相等</span></span><br><span class="line">    correct = pred.eq(label.view(<span class="number">1</span>, <span class="number">-1</span>).expand_as(pred)) <span class="comment"># 与正确标签序列形成的矩阵相比，生成True/False矩阵</span></span><br><span class="line"><span class="comment">#     print(correct)</span></span><br><span class="line"></span><br><span class="line">    rtn = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> topk:</span><br><span class="line">        correct_k = correct[:k].view(<span class="number">-1</span>).float().sum(<span class="number">0</span>) <span class="comment"># 前k行的数据 然后平整到1维度，来计算true的总个数</span></span><br><span class="line">        rtn.append(correct_k.mul_(<span class="number">100.0</span> / batch_size)) <span class="comment"># mul_() ternsor 的乘法  正确的数目/总的数目 乘以100 变成百分比</span></span><br><span class="line">    <span class="keyword">return</span> rtn</span><br></pre></td></tr></table></figure>
<h3 id="tensorboard画图"><a href="#tensorboard画图" class="headerlink" title="tensorboard画图"></a>tensorboard画图</h3><p>详细的参数讲解参考：<a href="https://www.pytorchtutorial.com/pytorch-builtin-tensorboard/" target="_blank" rel="noopener">https://www.pytorchtutorial.com/pytorch-builtin-tensorboard/</a><br>在使用pip install安装tensorboard如果速度很慢经常断线的话可以换个国内的源：<br><code>pip config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter </span><br><span class="line">writer = SummaryWriter(<span class="string">'./tensortboard/'</span>)</span><br></pre></td></tr></table></figure>
<p>画图的结果是实时，还可以放大放小，曲线的平滑度设置等，比自己写的画图函数要方便很多：</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587879396/blog/deep-learning/tensorboard.jpg" alt=""></p>
<h2 id="迭代训练"><a href="#迭代训练" class="headerlink" title="迭代训练"></a>迭代训练</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">( epoch, train_loader, device, model, criterion, optimizer,tensorboard_path)</span>:</span></span><br><span class="line">    model.train()</span><br><span class="line">    train_loss = <span class="number">0.0</span></span><br><span class="line">    top1 = AvgrageMeter()</span><br><span class="line">    train_loader = tqdm(train_loader)  <span class="comment">#转换成tqdm类型 以方便增加日志的输出</span></span><br><span class="line"></span><br><span class="line">    model = model.to(device)</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> range(epoch):</span><br><span class="line">        running_loss = <span class="number">0.0</span></span><br><span class="line">        train_loader.set_description(<span class="string">'[%s%04d/%04d %s%f]'</span> % (<span class="string">'Epoch:'</span>, e + <span class="number">1</span>, epoch, <span class="string">'lr:'</span>, <span class="number">0.001</span>))</span><br><span class="line">        <span class="keyword">for</span> i, data <span class="keyword">in</span> enumerate(train_loader, <span class="number">0</span>):  <span class="comment"># 0是下标起始位置默认为0</span></span><br><span class="line">            inputs, labels = data[<span class="number">0</span>].to(device), data[<span class="number">1</span>].to(device)</span><br><span class="line">            <span class="comment"># 初始为0，清除上个batch的梯度信息</span></span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            outputs = model(inputs)</span><br><span class="line">            loss = criterion(outputs,labels)</span><br><span class="line">            loss.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            <span class="comment"># topk 准确率计算</span></span><br><span class="line">            prec1, prec2 = accuracy(outputs, labels, topk=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">            n = inputs.size(<span class="number">0</span>)</span><br><span class="line">            top1.update(prec1.item(), n)</span><br><span class="line">            train_loss += loss.item()</span><br><span class="line">            postfix = &#123;<span class="string">'train_loss'</span>: <span class="string">'%.6f'</span> % (train_loss / (i + <span class="number">1</span>)), <span class="string">'train_acc'</span>: <span class="string">'%.6f'</span> % top1.avg&#125;</span><br><span class="line">            train_loader.set_postfix(log=postfix)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ternsorboard 曲线绘制</span></span><br><span class="line">            writer = SummaryWriter(tensorboard_path)</span><br><span class="line">            writer.add_scalar(<span class="string">'Train/Loss'</span>, loss.item(), epoch)</span><br><span class="line">            writer.add_scalar(<span class="string">'Train/Accuracy'</span>, top1.avg, epoch)</span><br><span class="line">            writer.flush()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Finished Training'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="模型评估"><a href="#模型评估" class="headerlink" title="模型评估"></a>模型评估</h2><p>准确率验证<br>在验证集上面的验证，求网络的的准确率指标</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(validate_loader, device, model, criterion)</span>:</span></span><br><span class="line">    val_acc = <span class="number">0.0</span></span><br><span class="line">    model = model.to(device)</span><br><span class="line">    model.eval()</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():  <span class="comment"># 进行评测的时候网络不更新梯度</span></span><br><span class="line">        val_top1 = AvgrageMeter()</span><br><span class="line">        validate_loader = tqdm(validate_loader)</span><br><span class="line">        validate_loss = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> i, data <span class="keyword">in</span> enumerate(validate_loader, <span class="number">0</span>):  <span class="comment"># 0是下标起始位置默认为0</span></span><br><span class="line">            inputs, labels = data[<span class="number">0</span>].to(device), data[<span class="number">1</span>].to(device)</span><br><span class="line">            <span class="comment">#         inputs,labels = data[0],data[1]</span></span><br><span class="line">            outputs = model(inputs)</span><br><span class="line">            loss = criterion(outputs, labels)</span><br><span class="line"></span><br><span class="line">            prec1, prec2 = accuracy(outputs, labels, topk=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">            n = inputs.size(<span class="number">0</span>)</span><br><span class="line">            val_top1.update(prec1.item(), n)</span><br><span class="line">            validate_loss += loss.item()</span><br><span class="line">            postfix = &#123;<span class="string">'validate_loss'</span>: <span class="string">'%.6f'</span> % (validate_loss / (i + <span class="number">1</span>)), <span class="string">'validate_acc'</span>: <span class="string">'%.6f'</span> % val_top1.avg&#125;</span><br><span class="line">            validate_loader.set_postfix(log=postfix)</span><br><span class="line">        val_acc = val_top1.avg</span><br><span class="line">    <span class="keyword">return</span> val_acc</span><br></pre></td></tr></table></figure>
<h2 id="输出测试集的预测结果"><a href="#输出测试集的预测结果" class="headerlink" title="输出测试集的预测结果"></a>输出测试集的预测结果</h2><p>将测试集输入进网络，得到测试集的预测结果，并转换成csv文件，用来提交到Kaggle上进行评分。需要注意的是，因为官网要求给的是图片是狗的概率，需要将网络的输出转成概率值。</p>
<p>但实际上测试的时候网络的输出是一正一负的值，不是概率值。这是因为测试的时候没有计算loss ，而softmax这个过程是在计算交叉熵的时候自动计算的，所以在网络架构中最后一层全连接输出后没有softmax计算。因此需要我们手动增加上softmax的过程，这样经过softmax后就可以变成两个概率值了!将图片是狗的概率保存下来，并转成符合官方要求的提交格式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submission</span><span class="params">(csv_path,test_loader, device, model)</span>:</span></span><br><span class="line">    result_list = []</span><br><span class="line">    model = model.to(device)</span><br><span class="line">    test_loader = tqdm(test_loader)</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():  <span class="comment"># 进行评测的时候网络不更新梯度</span></span><br><span class="line">        <span class="keyword">for</span> i, data <span class="keyword">in</span> enumerate(test_loader, <span class="number">0</span>):</span><br><span class="line">            images, labels = data[<span class="number">0</span>].to(device), data[<span class="number">1</span>].to(device)</span><br><span class="line">            outputs = model(images)</span><br><span class="line">            softmax_func = nn.Softmax(dim=<span class="number">1</span>)  <span class="comment"># dim=1表示行的和为1</span></span><br><span class="line">            soft_output = softmax_func(outputs)</span><br><span class="line">            predicted = soft_output[:, <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(predicted)):</span><br><span class="line">                result_list.append(&#123;</span><br><span class="line">                    <span class="string">"id"</span>: labels[i].item(),</span><br><span class="line">                    <span class="string">"label"</span>: predicted[i].item()</span><br><span class="line">                &#125;)</span><br><span class="line">    <span class="comment"># 从list转成 dataframe 然后保存为csv文件</span></span><br><span class="line">    columns = result_list[<span class="number">0</span>].keys()</span><br><span class="line">    result_dict = &#123;col: [anno[col] <span class="keyword">for</span> anno <span class="keyword">in</span> result_list] <span class="keyword">for</span> col <span class="keyword">in</span> columns&#125;</span><br><span class="line">    result_df = pd.DataFrame(result_dict)</span><br><span class="line">    result_df = result_df.sort_values(<span class="string">"id"</span>)</span><br><span class="line">    result_df.to_csv(csv_path, index=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2 id="完整调用流程"><a href="#完整调用流程" class="headerlink" title="完整调用流程"></a>完整调用流程</h2><p> 损失函数和优化方法的确定</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">net = MyCNN()</span><br><span class="line">device = torch.device(<span class="string">"cuda:0"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line"><span class="comment"># criterion = nn.BCELoss()  #二分类交叉熵损失函数</span></span><br><span class="line"><span class="comment"># criterion = nn.BCEWithLogitsLoss() #二分类交叉熵损失函数 带log loss</span></span><br><span class="line"><span class="comment"># criterion = nn.MSELoss()</span></span><br><span class="line"></span><br><span class="line">optimizer = optim.SGD(net.parameters(), lr=<span class="number">0.001</span>, momentum=<span class="number">0.9</span>)</span><br><span class="line"><span class="comment">#也可以选择Adam优化方法</span></span><br><span class="line"><span class="comment"># optimizer = torch.optim.Adam(net.parameters(),lr=1e-2)</span></span><br></pre></td></tr></table></figure>
<h3 id="训练过程"><a href="#训练过程" class="headerlink" title="训练过程"></a><strong>训练过程</strong></h3><p>需要传入epoch数目，训练数据加载器，设备，网络模型，损失函数，优化方法和tensorboard画图的路径等参数。<br>注意的是如果使用完整的官方训练数据集来训练网络后，用这个网络去在验证集上面验证是没有意义的，因为验证集的数据是从完整训练数据集上面划分出来，所以相当于在用训练数据验证性能。用划分过后的new_train_loader训练的网络在进行验证才有意义。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train( 1, train_loader, device,net, criterion, optimizer,tensorboard_path) # 完整的训练数据集</span></span><br><span class="line">train( <span class="number">1</span>, new_train_loader, device,net, criterion, optimizer,tensorboard_path) <span class="comment"># 划分80%后的训练数据集</span></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<pre><code>Finished Training
</code></pre><p>在训练的时候会用tensorboard保存每个时刻的训练数据，需要新打开一个命令端口输入：<br><code>tensorboard --logdir=/path_to_log_dir/ --port 6006</code> 命令，然后通过在浏览器中输入网址<a href="http://localhost:6006/" target="_blank" rel="noopener">http://localhost:6006/</a> 来查看</p>
<p>模型的保存和加载</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">torch.save(net.state_dict(), model_save_path)</span><br><span class="line">val_net = MyCNN()</span><br><span class="line">val_net.load_state_dict(torch.load(<span class="string">'./dogs-vs-cats_12epoch_valnet.pth'</span>))</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<pre><code>&lt;All keys matched successfully&gt;
</code></pre><h3 id="验证过程"><a href="#验证过程" class="headerlink" title="验证过程"></a><strong>验证过程</strong></h3><p>输入的网络是上面训练过的网络，或者从模型权重保存路径加载的模型。输出模型在自己划分的验证集上面的准确率，结果是98.84%</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validate(validate_loader,device,val_net,criterion)</span><br></pre></td></tr></table></figure>
<p>​    输出：</p>
<pre><code>98.92
</code></pre><h3 id="输出测试集预测结果"><a href="#输出测试集预测结果" class="headerlink" title="输出测试集预测结果"></a><strong>输出测试集预测结果</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">submission(<span class="string">'./test.csv'</span>,test_loader, device, val_net)</span><br></pre></td></tr></table></figure>
<p>最后在Kaggle上提交预测结果csv文件，得到打分。 需要先报名参赛这些操作，而且只有Dogs vs. Cats Redux: Kernels Edition这个才能够提交数据，最开始的那个6年前的提交通道已经关闭了。提交可以下载Kaggle的API在命令行提交，也可以直接在<a href="https://www.kaggle.com/c/dogs-vs-cats-redux-kernels-edition/submit" target="_blank" rel="noopener">提交链接</a>提交</p>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>文章基于Notebook的过程，也构建了对应的<a href="https://github.com/BraveY/AI-with-code/tree/master/dog-vs-cat/pycharm-project/src" target="_blank" rel="noopener">Pycharm项目</a>，将整个过程分模块来编码,架构更清晰。</p>
<p>我总共训练了三个网络，其中MyCNN_net_1使用全部的训练数据，MyCNN_net_2使用划分过的训练数据，RestNet50是预训练的模型，使用完整训练数据训练。</p>
<p>Kaggle上的评分是根据log loss来计算的，分数越低代表模型性能越好。然后其他两个网络使用的完整训练数据集是包含验证集的，所以没有计算验证集的准确率。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>网络</th>
<th>epochs</th>
<th>训练数据</th>
<th>得分</th>
<th>验证集准确率</th>
</tr>
</thead>
<tbody>
<tr>
<td>ResNet50</td>
<td>3</td>
<td>完整训练数据集</td>
<td>0.06691</td>
<td>-</td>
</tr>
<tr>
<td>MyCNN_net_1</td>
<td>12</td>
<td>划分的80%训练数据集</td>
<td>0.73358</td>
<td>98.92</td>
</tr>
<tr>
<td>MyCNN_net_2</td>
<td>12</td>
<td>完整训练数据集</td>
<td>0.94158</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
<p>实验结果并不严谨，只进行了一次，所以存在一些随机性。</p>
<p>其中使用预训练的ResNet50的效果非常好，在猫狗数据集上训练微调的时候loss就很低了，所以只训练了3轮。</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587879398/blog/deep-learning/Resnet50.jpg" alt=""></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>自己在搭建网络的时候遇到一个问题就是随便设置的一个网络结构的时候，发现交叉熵的loss会一直维持在0.69，不下降。暂时还没有搞懂问题出在哪儿，后面有时间了研究下，</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://bravey.github.io/2020-03-13-%E4%BD%BF%E7%94%A8Pytorch%E6%A1%86%E6%9E%B6%E7%9A%84CNN%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%EF%BC%88MNIST%EF%BC%89%E8%AF%86%E5%88%AB.html">之前的手写数字识别</a></p>
<p><a href="https://www.pytorchtutorial.com/pytorch-builtin-tensorboard/" target="_blank" rel="noopener">tensorboard画图</a><br><a href="https://www.zhihu.com/question/38341743" target="_blank" rel="noopener">pip源的更新</a><br><a href="https://www.cnblogs.com/marsggbo/p/10496696.html" target="_blank" rel="noopener">数据集的划分</a><br><a href="https://github.com/ShunLu91/Single-Path-One-Shot-NAS" target="_blank" rel="noopener">topk的计算</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2019-12-20-LSTM%E4%B8%8EProphet%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B%E5%AE%9E%E9%AA%8C.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019-12-20-LSTM%E4%B8%8EProphet%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B%E5%AE%9E%E9%AA%8C.html" class="post-title-link" itemprop="url">LSTM与Prophet时间序列预测实验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-20 22:24:26" itemprop="dateCreated datePublished" datetime="2019-12-20T22:24:26+08:00">2019-12-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-25 16:17:58" itemprop="dateModified" datetime="2020-04-25T16:17:58+08:00">2020-04-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019-12-20-LSTM%E4%B8%8EProphet%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B%E5%AE%9E%E9%AA%8C.html" class="post-meta-item leancloud_visitors" data-flag-title="LSTM与Prophet时间序列预测实验" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2019-12-20-LSTM%E4%B8%8EProphet%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B%E5%AE%9E%E9%AA%8C.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019-12-20-LSTM与Prophet时间序列预测实验.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="LSTM与Prophet时间序列预测实验"><a href="#LSTM与Prophet时间序列预测实验" class="headerlink" title="LSTM与Prophet时间序列预测实验"></a>LSTM与Prophet时间序列预测实验</h1><p>分别使用Pytorch构建的LSTM网络与Facebook开源的Prophet工具对时间序列进行预测的一个对比小实验，同时作为一个小白也借着这个实验来学习下Pytorch的使用，因为第一次使用，所以会比较详细的注释代码。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019-12-20-LSTM%E4%B8%8EProphet%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B%E5%AE%9E%E9%AA%8C.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-29-leetcode-148-Sort-List.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-29-leetcode-148-Sort-List.html" class="post-title-link" itemprop="url">leetcode 148 Sort List</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-29 16:20:16 / 修改时间：16:51:31" itemprop="dateCreated datePublished" datetime="2020-04-29T16:20:16+08:00">2020-04-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index">
                    <span itemprop="name">题解</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-29-leetcode-148-Sort-List.html" class="post-meta-item leancloud_visitors" data-flag-title="leetcode 148 Sort List" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-29-leetcode-148-Sort-List.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-29-leetcode-148-Sort-List.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p><a href="https://leetcode.com/problems/sort-list/" target="_blank" rel="noopener">题目链接</a> 对链表进行排序，常数空间复杂度和$O(nlogn)$ 的时间复杂度</p>
<p>Sort a linked list in <em>O</em>(<em>n</em> log <em>n</em>) time using constant space complexity.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 4-&gt;2-&gt;1-&gt;3</span><br><span class="line">Output: 1-&gt;2-&gt;3-&gt;4</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: -1-&gt;5-&gt;3-&gt;4-&gt;0</span><br><span class="line">Output: -1-&gt;0-&gt;3-&gt;4-&gt;5</span><br></pre></td></tr></table></figure>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>排序能够$O(nlogn)$ 的有三种，堆排序，快排，归并排序。快排是需要两个指针同时向中间移动的，题目是单链表所以排除了。</p>
<p>自己之前没有接触过用链表的排序，所以没想到怎么对链表进行一分为二来分治。实际上需要使用快慢指针来进行。</p>
<h3 id="归并排序-递归"><a href="#归并排序-递归" class="headerlink" title="归并排序 递归"></a>归并排序 递归</h3><p>用快慢指针来寻找中间的节点，快指针每次走两步，慢指针每次走一步，当快指针到达末尾的时候，满指针走了一半，因此也就是中间节点。后续的递归调用方法和之前的用数组的形式，大体一致，参考之前的<a href="https://bravey.github.io/2019-10-07-%E9%80%86%E5%BA%8F%E5%AF%B9%E7%9A%84%E8%AE%A1%E6%95%B0.html">逆序对计数</a>。</p>
<h3 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h3><p>时间复杂度是$O(nlogn)$ 但是空间复杂度是$O(logn)$ ,其实有点疑惑递归的怎么算空间复杂度是根据递归的调用次数来吗？</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 40 ms, faster than 100.00% of C++ online submissions for Sort List.</span></span><br><span class="line"><span class="comment">Memory Usage: 12.8 MB, less than 25.00% of C++ online submissions for Sort List.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">sortList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!head || !head-&gt;next) <span class="keyword">return</span> head; <span class="comment">//递归必备的出口</span></span><br><span class="line">		ListNode* slow = head;</span><br><span class="line">		ListNode*	fast = head-&gt;next;</span><br><span class="line">		<span class="comment">// 寻找中间的节点</span></span><br><span class="line">		<span class="keyword">while</span> (fast &amp;&amp; fast-&gt;next) &#123;</span><br><span class="line">			<span class="comment">//fast 刚好到达末尾的时候 fast-&gt;next 为nullptr</span></span><br><span class="line">			<span class="comment">//或者刚好超过末尾1个，fast为nullptr</span></span><br><span class="line">			slow = slow-&gt;next;</span><br><span class="line">			fast = fast-&gt;next-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		ListNode* l2 = slow-&gt;next;</span><br><span class="line">		slow-&gt;next = <span class="literal">NULL</span>;<span class="comment">// 中间断开</span></span><br><span class="line">		head = sortList(head);</span><br><span class="line">		l2 = sortList(l2);</span><br><span class="line">		head = merge(head, l2);<span class="comment">//merge到前半部分上面</span></span><br><span class="line">		<span class="keyword">return</span> head;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">merge</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">		<span class="function">ListNode <span class="title">dummy</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">		ListNode* tail = &amp;dummy;</span><br><span class="line">		<span class="keyword">while</span> (l1 &amp;&amp; l2) &#123;</span><br><span class="line">		<span class="keyword">if</span> (l1-&gt;val &gt; l2-&gt;val) swap(l1, l2);</span><br><span class="line">			<span class="comment">// swap 交换的是变量值，对链表而言，交换了整个链表。</span></span><br><span class="line">			<span class="comment">//始终让l1指向当前最小的头节点的链表，简洁些，不用if else</span></span><br><span class="line">			tail-&gt;next = l1;</span><br><span class="line">			l1 = l1-&gt;next;</span><br><span class="line">			tail = tail-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		tail-&gt;next = l1 ? l1 : l2;</span><br><span class="line">		<span class="keyword">return</span> dummy.next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>需要注意下的是swap的使用，<code>if (l1-&gt;val &gt; l2-&gt;val) swap(l1, l2);</code> 这一句swap交换的不是节点的值，而是整个链表。</p>
<h3 id="归并排序-循环"><a href="#归并排序-循环" class="headerlink" title="归并排序 循环"></a>归并排序 循环</h3><p>为了实现$O(1)$的空间复杂度，需要将递归改成循环，也就是自己实现递归的逻辑。思路是从最底层n=1的时候开始，两两合并，然后是n=2，4…这样一直到最后完成合并。</p>
<p>所以需要一个专门的函数来实现按照长度n对链表分组，然后在循环里面迭代调用完成分组。另外merge也需要返回头和尾，来方便相邻之间分组的连接。</p>
<h3 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度"></a>复杂度</h3><p>时间复杂度是$O(nlogn)$ 但是空间复杂度是$O(1)$ </p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><p>代码其实有点难度的，特别是主循环中的逻辑，感觉自己下次不一定能够复现出来。</p>
<figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution2</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">sortList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 0 or 1 element, we are done.</span></span><br><span class="line">		<span class="keyword">if</span> (!head || !head-&gt;next) <span class="keyword">return</span> head;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">		ListNode* cur = head;</span><br><span class="line">		<span class="keyword">while</span> (cur = cur-&gt;next) ++len;</span><br><span class="line"></span><br><span class="line">		<span class="function">ListNode <span class="title">dummy</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">		dummy.next = head;</span><br><span class="line">		ListNode* l;</span><br><span class="line">		ListNode* r;</span><br><span class="line">		ListNode* tail;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">1</span>; n &lt; len; n &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">			cur = dummy.next; <span class="comment">// partial sorted head</span></span><br><span class="line">			tail = &amp;dummy;</span><br><span class="line">			<span class="keyword">while</span> (cur) &#123;</span><br><span class="line">				l = cur;</span><br><span class="line">				r = split(l, n);</span><br><span class="line">				cur = split(r, n);</span><br><span class="line">				<span class="keyword">auto</span> merged = merge(l, r);</span><br><span class="line">				tail-&gt;next = merged.first;  <span class="comment">// 合并list的head 让前面合并后末尾指向新合并的头</span></span><br><span class="line">				tail = merged.second; <span class="comment">// 合并list的tail ，然后重新指向新合并的末尾</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dummy.next;</span><br><span class="line">	&#125;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// Splits the list into two parts, first n element and the rest.</span></span><br><span class="line">	<span class="comment">// Returns the head of the rest.</span></span><br><span class="line">	<span class="function">ListNode* <span class="title">split</span><span class="params">(ListNode* head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (--n &amp;&amp; head) <span class="comment">// 分割的长度可能超过head 的长度</span></span><br><span class="line">			head = head-&gt;next;</span><br><span class="line">		ListNode* rest = head ? head-&gt;next : <span class="literal">nullptr</span>;</span><br><span class="line">		<span class="keyword">if</span> (head) head-&gt;next = <span class="literal">nullptr</span>; <span class="comment">// 如果有连接 就断开</span></span><br><span class="line">		<span class="keyword">return</span> rest;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Merges two lists, returns the head and tail of the merged list.</span></span><br><span class="line">	pair&lt;ListNode*, ListNode*&gt; merge(ListNode* l1, ListNode* l2) &#123;</span><br><span class="line">		<span class="function">ListNode <span class="title">dummy</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">		ListNode* tail = &amp;dummy;</span><br><span class="line">		<span class="keyword">while</span> (l1 &amp;&amp; l2) &#123;</span><br><span class="line">			<span class="keyword">if</span> (l1-&gt;val &gt; l2-&gt;val) swap(l1, l2);</span><br><span class="line">			tail-&gt;next = l1;</span><br><span class="line">			l1 = l1-&gt;next;</span><br><span class="line">			tail = tail-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		tail-&gt;next = l1 ? l1 : l2; <span class="comment">// 剩下的连上</span></span><br><span class="line">		<span class="keyword">while</span> (tail-&gt;next) tail = tail-&gt;next; <span class="comment">//找到末尾， 方便后续的接</span></span><br><span class="line">		<span class="keyword">return</span> &#123;dummy.next, tail&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tail-&gt;next = l1 ? l1 : l2; <span class="comment">// 剩下的连上</span></span><br><span class="line"><span class="keyword">while</span> (tail-&gt;next) tail = tail-&gt;next; <span class="comment">//找到末尾， 方便后续的接</span></span><br></pre></td></tr></table></figure>
<p>这里需要稍微说明的是taila-&gt;next 的修改就是对原来的节点next指针进行修改，后tail重新只想其他节点后，前面的修改依然会保留，而不是重置了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.bilibili.com/video/BV1jW411d7z7?t=1100" target="_blank" rel="noopener">huahua</a> 代码值得学习</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-25-leetcode-55-Jump-Game.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-25-leetcode-55-Jump-Game.html" class="post-title-link" itemprop="url">leetcode 55 Jump Game</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-25 12:32:59 / 修改时间：18:14:57" itemprop="dateCreated datePublished" datetime="2020-04-25T12:32:59+08:00">2020-04-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index">
                    <span itemprop="name">题解</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-25-leetcode-55-Jump-Game.html" class="post-meta-item leancloud_visitors" data-flag-title="leetcode 55 Jump Game" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-25-leetcode-55-Jump-Game.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-25-leetcode-55-Jump-Game.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p><a href="https://leetcode.com/problems/jump-game/" target="_blank" rel="noopener">题目链接</a> 按照数组的值作为步数进行跳跃，能否到达最末端</p>
<p>Given an array of non-negative integers, you are initially positioned at the first index of the array.</p>
<p>Each element in the array represents your maximum jump length at that position.</p>
<p>Determine if you are able to reach the last index.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: [2,3,1,1,4]</span><br><span class="line">Output: true</span><br><span class="line">Explanation: Jump 1 step from index 0 to 1, then 3 steps to the last index.</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,2,1,0,4]</span><br><span class="line">Output: false</span><br><span class="line">Explanation: You will always arrive at index 3 no matter what. Its maximum</span><br><span class="line">             jump length is 0, which makes it impossible to reach the last index.</span><br></pre></td></tr></table></figure>
<h2 id="记忆化递归"><a href="#记忆化递归" class="headerlink" title="记忆化递归"></a>记忆化递归</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>首先是根据题目的叙述直接暴力的遍历每种可能性，具体的实现方法是用递归。</p>
<p>从后向前考虑每个节点能否到达最后一个节点，对能够达到的节点nums[i]，用递归的思路将nums[0…i]这个数组递归调用后来求这个节点的答案。如果有可行的解直接就返回。</p>
<p>在实现的时候考虑到同一个节点可能会被重复计算很多次，所以使用记忆化递归，用一个hash数组来存储已经计算过的节点，来避免重复计算。</p>
<p>比如[2,3,1,1,4]对第4个节点来说，第一个1节点3和第三个节点1都是可行的，而计算的第三个节点1来说，第1个节点依然是可行的，如果不记录第1个节点3的答案的话，就会重复计算。</p>
<h3 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a><strong>复杂度</strong></h3><p>因为相当于暴力枚举了所有可能的路径，所以复杂度是指数级别的$O(k^n)$ k 是每个节点的可行解。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 1204 ms, faster than 5.42% of C++ online submissions for Jump Game.</span></span><br><span class="line"><span class="comment">Memory Usage: 18 MB, less than 5.26% of C++ online submissions for Jump Game.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution2</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">canJump</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">		memo[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">return</span> helper(nums, n - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">helper</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> <span class="built_in">end</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (memo.count(<span class="built_in">end</span>)) <span class="keyword">return</span> memo[<span class="built_in">end</span>];</span><br><span class="line">		<span class="keyword">bool</span> ans = <span class="literal">false</span>;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; able;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="built_in">end</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (nums[i] &gt;= <span class="built_in">end</span> - i) &#123;</span><br><span class="line">				<span class="keyword">if</span> (ans == <span class="literal">true</span>) <span class="keyword">break</span>;</span><br><span class="line">				ans = ans | helper(nums, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		memo[<span class="built_in">end</span>] = ans;</span><br><span class="line">		<span class="keyword">return</span> memo[<span class="built_in">end</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">bool</span>&gt; memo;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h2><p>更新所有节点能够走的最远值。</p>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>自己最开始想的是如果每个都选择按照最大的步数走的话，可能出现最大的步数所到的节点值为0，也就无法到达末尾，因此没有想出来具体的贪心方法。</p>
<p>实际上，每个节点选择最大的步数来走在遍历的时候，可以设置一个far变量来记录所有节点可以到达的最远节点。如果far小于了当前节点，说明无法到达当前节点，也就更不能到达末尾。如果遍历完毕后far的大小大于等于n-1，说明可以到达的节点已经超过最后的节点了，可以完成跳跃。</p>
<p>设置了个最远变量后前面说的那种情况也就不存在了，因为只是记录了可能到达的最远值，没有要求只能按照最远的步数来走。</p>
<h3 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度"></a>复杂度</h3><p>遍历一次因此$O(n)$ 的复杂度.</p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 8 ms, faster than 93.89% of C++ online submissions for Jump Game.</span></span><br><span class="line"><span class="comment">Memory Usage: 7.8 MB, less than 100.00% of C++ online submissions for Jump Game.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution3</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">canJump</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">int</span> far = nums[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i &gt; far) <span class="comment">//最远路径无法到达当前位置</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			far = <span class="built_in">max</span>(far, i + nums[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> far &gt;= n - <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zxi.mytechroad.com/blog/greedy/leetcode-55-jump-game/" target="_blank" rel="noopener">https://zxi.mytechroad.com/blog/greedy/leetcode-55-jump-game/</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-24-leetcode-134-Gas-Station.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-24-leetcode-134-Gas-Station.html" class="post-title-link" itemprop="url">leetcode 134 Gas Station</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-24 13:55:23 / 修改时间：14:52:55" itemprop="dateCreated datePublished" datetime="2020-04-24T13:55:23+08:00">2020-04-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index">
                    <span itemprop="name">题解</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-24-leetcode-134-Gas-Station.html" class="post-meta-item leancloud_visitors" data-flag-title="leetcode 134 Gas Station" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-24-leetcode-134-Gas-Station.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-24-leetcode-134-Gas-Station.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p><a href="https://leetcode.com/problems/gas-station/" target="_blank" rel="noopener">题目链接</a>  给出一个加油站容量数组，和路途消耗数组，问是否可以完成一次循环。</p>
<p>There are <em>N</em> gas stations along a circular route, where the amount of gas at station <em>i</em> is <code>gas[i]</code>.</p>
<p>You have a car with an unlimited gas tank and it costs <code>cost[i]</code> of gas to travel from station <em>i</em> to its next station (<em>i</em>+1). You begin the journey with an empty tank at one of the gas stations.</p>
<p>Return the starting gas station’s index if you can travel around the circuit once in the clockwise direction, otherwise return -1.</p>
<p><strong>Note:</strong></p>
<ul>
<li>If there exists a solution, it is guaranteed to be unique.</li>
<li>Both input arrays are non-empty and have the same length.</li>
<li>Each element in the input arrays is a non-negative integer.</li>
</ul>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">gas  &#x3D; [1,2,3,4,5]</span><br><span class="line">cost &#x3D; [3,4,5,1,2]</span><br><span class="line"></span><br><span class="line">Output: 3</span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">Start at station 3 (index 3) and fill up with 4 unit of gas. Your tank &#x3D; 0 + 4 &#x3D; 4</span><br><span class="line">Travel to station 4. Your tank &#x3D; 4 - 1 + 5 &#x3D; 8</span><br><span class="line">Travel to station 0. Your tank &#x3D; 8 - 2 + 1 &#x3D; 7</span><br><span class="line">Travel to station 1. Your tank &#x3D; 7 - 3 + 2 &#x3D; 6</span><br><span class="line">Travel to station 2. Your tank &#x3D; 6 - 4 + 3 &#x3D; 5</span><br><span class="line">Travel to station 3. The cost is 5. Your gas is just enough to travel back to station 3.</span><br><span class="line">Therefore, return 3 as the starting index.</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">gas  &#x3D; [2,3,4]</span><br><span class="line">cost &#x3D; [3,4,3]</span><br><span class="line"></span><br><span class="line">Output: -1</span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">You can&#39;t start at station 0 or 1, as there is not enough gas to travel to the next station.</span><br><span class="line">Let&#39;s start at station 2 and fill up with 4 unit of gas. Your tank &#x3D; 0 + 4 &#x3D; 4</span><br><span class="line">Travel to station 0. Your tank &#x3D; 4 - 3 + 2 &#x3D; 3</span><br><span class="line">Travel to station 1. Your tank &#x3D; 3 - 3 + 3 &#x3D; 3</span><br><span class="line">You cannot travel back to station 2, as it requires 4 unit of gas but you only have 3.</span><br><span class="line">Therefore, you can&#39;t travel around the circuit once no matter where you start.</span><br></pre></td></tr></table></figure>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>贪心的方式就是每到一个加油站就加满所有的油。</p>
<h3 id="暴力枚举"><a href="#暴力枚举" class="headerlink" title="暴力枚举"></a>暴力枚举</h3><p>按照题意叙述，可以对每个起点进行一次判定，判定方法就是题目叙述样例的方式，每次都加满油然后走下一段路程，如果油量不够下一段路程则返回-1，如果可以完成路程的话继续走下一段。</p>
<p><strong>复杂度</strong></p>
<p>需要两层for循环因此是$O(n^2)$ </p>
<h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p>仔细思考题目，可以得到一个结论，只有当gas数组之和大于cost数组的时候才可能有解，也就是只有加油站的总油量大于路程所需的消耗量的时候才能完成路程。</p>
<p>将gas数组和cost数组相减可以得到每个站点能否完成下一段的值，如果gas[i]-cost[i]的值非负，说明在这个站点中加的油足够完成下一段路程。如果值为负，说明不能完成下一段路程，但是在到达这个站点的时候可能有之前站点剩余的油量。</p>
<p>因此从第0个站点开始，到最后一个站点截止。将每个站点的gas[i]-cost[i]的值进行累加，如果累加值大于等于0 ，说明从出发点到当前点的油量足够。如果累加上当前站点的gas[i]-cost[i]的值变为负数了，说明当前站点不能到达下一个站点。当累积值为负的时候，将下个站点作为起点，然后累加值置为0 重新开始累加值的计算。</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587711117/blog/coding/lc134.jpg" alt=""></p>
<p>这样一来就会将站点分为k段，前k-1段的累加值都是负数，如果全程的累加值sum(0,n-1)大于0，则说明有解。因为：</p>
<script type="math/tex; mode=display">
sum(0,n-1) = cur(0,i-1) +cur(i,j-1)+\dots+cur(k,n-1)</script><p>所以当总和非负的时候，因为前面k-1段都是负值，所以最后一段一定为正数。也就是最后段的剩余油量足够填补前面k-1段的不足油量，从而完成整个路程。</p>
<p><strong>复杂度</strong></p>
<p>因为只需一层循环所以时间复杂度是$O(n)$</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="暴力枚举-1"><a href="#暴力枚举-1" class="headerlink" title="暴力枚举"></a>暴力枚举</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 208 ms, faster than 10.35% of C++ online submissions for Gas Station.</span></span><br><span class="line"><span class="comment">Memory Usage: 7 MB, less than 100.00% of C++ online submissions for Gas Station.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">canCompleteCircuit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; gas, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> n = gas.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> gas_left = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">int</span> index = i;</span><br><span class="line">			<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span> (gas[index] + gas_left &gt;= cost[index]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (count == n) <span class="keyword">break</span>;</span><br><span class="line">				gas_left = gas_left + gas[index] - cost[index];</span><br><span class="line">				<span class="keyword">if</span> (index + <span class="number">1</span> &lt; n )</span><br><span class="line">					index++;</span><br><span class="line">				<span class="keyword">else</span> index = <span class="number">0</span>;</span><br><span class="line">				count++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (count == n) <span class="keyword">return</span> i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="遍历-1"><a href="#遍历-1" class="headerlink" title="遍历"></a>遍历</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 4 ms, faster than 98.11% of C++ online submissions for Gas Station.</span></span><br><span class="line"><span class="comment">Memory Usage: 7 MB, less than 100.00% of C++ online submissions for Gas Station.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution2</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">canCompleteCircuit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; gas, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> n = gas.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">int</span> cur_gas = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">			cur_gas += gas[i] - cost[i];</span><br><span class="line">			sum += gas[i] - cost[i];</span><br><span class="line">			<span class="keyword">if</span> (cur_gas &lt; <span class="number">0</span>) &#123;</span><br><span class="line">				cur_gas = <span class="number">0</span>;</span><br><span class="line">				start = i + <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (sum &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> start;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/Irving_zhang/article/details/78367216" target="_blank" rel="noopener">https://blog.csdn.net/Irving_zhang/article/details/78367216</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-19-C++-return%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E7%BB%86%E8%8A%82.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-19-C++-return%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E7%BB%86%E8%8A%82.html" class="post-title-link" itemprop="url">C++ return一个对象的执行细节</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-19 16:21:22 / 修改时间：21:26:44" itemprop="dateCreated datePublished" datetime="2020-04-19T16:21:22+08:00">2020-04-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-19-C++-return%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E7%BB%86%E8%8A%82.html" class="post-meta-item leancloud_visitors" data-flag-title="C++ return一个对象的执行细节" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-19-C++-return%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E7%BB%86%E8%8A%82.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-19-C++-return一个对象的执行细节.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="C-return一个对象的执行细节"><a href="#C-return一个对象的执行细节" class="headerlink" title="C++ return一个对象的执行细节"></a>C++ return一个对象的执行细节</h1><p>同学发过来一道考试题，要求解释输出。好久没有用过这些知识了，所以顺便复习下。</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587302660/blog/cpp_test.jpg" alt=""></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>为了搞清楚里面知识，所以把代码增加了地址的输出来进行实验：</p>
<figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">	Solution(): id_(<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Default Constructor:id="</span></span><br><span class="line">		     &lt;&lt; id_ &lt;&lt; <span class="string">"	addr=:"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Solution(<span class="keyword">int</span> id): id_(id) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Constructor with Paramter:id="</span></span><br><span class="line">		     &lt;&lt; id_ &lt;&lt; <span class="string">"	addr=:"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Solution(<span class="keyword">const</span> Solution&amp;course): id_(course.id_) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Copy Constructor :id="</span></span><br><span class="line">		     &lt;&lt; id_ &lt;&lt; <span class="string">"	addr=:"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	~Solution() &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Destructor:id="</span></span><br><span class="line">		     &lt;&lt; id_ &lt;&lt; <span class="string">"	addr=:"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">GetId</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> id_;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> id_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Solution <span class="title">Max</span><span class="params">(Solution a, Solution b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (a.GetId() &gt; b.GetId()) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"end "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"end after return"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"end "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> b;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"end after return"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Q2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">Solution <span class="title">class1</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="comment">//Solution class2;</span></span><br><span class="line">	Solution class2 = class1;</span><br><span class="line">	<span class="comment">//class2 = class1;</span></span><br><span class="line">	Solution classX(5), classY(6);</span><br><span class="line">	Solution classZ;</span><br><span class="line">	<span class="comment">// classZ = class1;</span></span><br><span class="line">	<span class="comment">// Max(classX, classY);</span></span><br><span class="line">	classZ = Max(classX, classY);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"after max"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	Solution *pClasses = <span class="keyword">new</span> Solution[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">delete</span> [] pClasses;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* code */</span></span><br><span class="line">	Q2();</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出的结果是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Constructor with Paramter:id=1  addr=:0x61fedc </span><br><span class="line">Copy Constructor :id=1  addr=:0x61fed8</span><br><span class="line">Constructor with Paramter:id=5  addr=:0x61fed4</span><br><span class="line">Constructor with Paramter:id=6  addr=:0x61fed0</span><br><span class="line">Default Constructor:id=0        addr=:0x61fecc</span><br><span class="line">Copy Constructor :id=6  addr=:0x61fee4</span><br><span class="line">Copy Constructor :id=5  addr=:0x61fee8</span><br><span class="line">end</span><br><span class="line">Copy Constructor :id=6  addr=:0x61fee0</span><br><span class="line">Destructor:id=6 addr=:0x61fee0</span><br><span class="line">Destructor:id=5 addr=:0x61fee8</span><br><span class="line">Destructor:id=6 addr=:0x61fee4</span><br><span class="line">after max</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d74</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d78</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d7c</span><br><span class="line">Destructor:id=0 addr=:0xfc1d7c</span><br><span class="line">Destructor:id=0 addr=:0xfc1d78</span><br><span class="line">Destructor:id=0 addr=:0xfc1d74</span><br><span class="line">Destructor:id=6 addr=:0x61fecc</span><br><span class="line">Destructor:id=6 addr=:0x61fed0</span><br><span class="line">Destructor:id=5 addr=:0x61fed4</span><br><span class="line">Destructor:id=1 addr=:0x61fed8</span><br><span class="line">Destructor:id=1 addr=:0x61fedc</span><br></pre></td></tr></table></figure>
<p>可以看到输出结果与题目中的结果是有差别的，题目中的篮圈析构顺序是566，实验结果是656</p>
<h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p>在调用Max之前的输出结果很容易理解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Constructor with Paramter:id=1  addr=:0x61fedc  # class1 的参数构造</span><br><span class="line">Copy Constructor :id=1  addr=:0x61fed8			#Solution class2 = class1的拷贝构造</span><br><span class="line">Constructor with Paramter:id=5  addr=:0x61fed4  #classX的参数构造</span><br><span class="line">Constructor with Paramter:id=6  addr=:0x61fed0  #classY的参数构造</span><br><span class="line">Default Constructor:id=0        addr=:0x61fecc	#classZ的默认构造</span><br></pre></td></tr></table></figure>
<p>进入Max函数后从右向左依次进行参数的压栈，所以首先是b的拷贝构造，然后是a的拷贝构造。</p>
<p>接下来是一个很<strong>重要的细节</strong>，在执行return的时候会自动执行一个拷贝构造来生成一个临时的对象temp用来返回。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Copy Constructor :id=6  addr=:0x61fee4 			#b的拷贝构造</span><br><span class="line">Copy Constructor :id=5  addr=:0x61fee8 			#a的拷贝构造</span><br><span class="line">end</span><br><span class="line">Copy Constructor :id=6  addr=:0x61fee0			#return 产生的临时对象temp的拷贝构造</span><br></pre></td></tr></table></figure>
<p>在Max函数中参数入栈的顺序是：先是b然后是a最后是temp。</p>
<p>需要注意的是，在执行完return之后并没有立即就执行了出栈的操作。需要在完成<code>classZ = Max(classX, classY);</code> 这个赋值语句后才会执行出栈操作对栈中的对象执行析构操作。析构的顺序就是出栈的顺序，先入后出，后入先出。所以首先是temp变量的析构，然后是b这个形参的析构，最后才是a这个形参的析构。</p>
<p>所以参考链接里面的顺序也是有误的，并不是首先析构形参。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">after max</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d74 # temp变量的析构</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d78 # b这个形参的析构</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d7c # a这个形参的析构</span><br></pre></td></tr></table></figure>
<p>之后因为使用new来创建的数据，其内存是分配在堆上面的并没有在Max的函数栈中，需要手动delete来销毁来防止内存泄漏。因此首先是3个0个构造和析构。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> new</span></span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d74</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d78</span><br><span class="line">Default Constructor:id=0        addr=:0xfc1d7c</span><br><span class="line"><span class="meta">#</span><span class="bash">delete</span></span><br><span class="line">Destructor:id=0 addr=:0xfc1d7c</span><br><span class="line">Destructor:id=0 addr=:0xfc1d78</span><br><span class="line">Destructor:id=0 addr=:0xfc1d74</span><br></pre></td></tr></table></figure>
<p>最后是对Max这个函数中入栈的局部变量执行出栈与销毁的操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Destructor:id=6 addr=:0x61fecc 		#classZ的析构</span><br><span class="line">Destructor:id=6 addr=:0x61fed0		#classY的析构</span><br><span class="line">Destructor:id=5 addr=:0x61fed4		#classX的析构</span><br><span class="line">Destructor:id=1 addr=:0x61fed8		#class2的析构</span><br><span class="line">Destructor:id=1 addr=:0x61fedc		#class1的析构</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>主要是两个点比较迷惑</p>
<ol>
<li>Max函数return 的操作是通过自动调用拷贝构造一个临时对象来执行的返回的，临时对象的析构需要等到<code>classZ = Max(classX, classY);</code>语句执行完毕后</li>
<li>如果先构造了一个对象，然后再使用=来进行赋值是不会执行拷贝构造的，不是只要使用了=就会执行拷贝构造。所以<code>Solution class2 = class1;</code>这个语句没有先构造对象，因此执行了拷贝构造。而<code>classZ = Max(classX, classY);</code> 这个语句中，<code>classZ</code>事先用<code>Solution classZ;</code>构造过，所以不会再执行拷贝构造的操作。这个=只负责值之间的传递。</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/fruitz/article/details/41624017" target="_blank" rel="noopener">https://blog.csdn.net/fruitz/article/details/41624017</a>  析构顺序有误</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-17-leetcode-454-4sum-%E2%85%A1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-17-leetcode-454-4sum-%E2%85%A1.html" class="post-title-link" itemprop="url">leetcode 454 4sum-II</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-17 21:36:42" itemprop="dateCreated datePublished" datetime="2020-04-17T21:36:42+08:00">2020-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-25 19:15:19" itemprop="dateModified" datetime="2020-04-25T19:15:19+08:00">2020-04-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index">
                    <span itemprop="name">题解</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-17-leetcode-454-4sum-%E2%85%A1.html" class="post-meta-item leancloud_visitors" data-flag-title="leetcode 454 4sum-II" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-17-leetcode-454-4sum-%E2%85%A1.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-17-leetcode-454-4sum-Ⅱ.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p><a href="https://leetcode.com/problems/4sum-ii/" target="_blank" rel="noopener">题目链接</a></p>
<p>4个数组分别选择一个元素相加，求和为0的组合的个数</p>
<p>Given four lists A, B, C, D of integer values, compute how many tuples <code>(i, j, k, l)</code> there are such that <code>A[i] + B[j] + C[k] + D[l]</code> is zero.</p>
<p>To make problem a bit easier, all A, B, C, D have same length of N where 0 ≤ N ≤ 500. All integers are in the range of -228 to 228 - 1 and the result is guaranteed to be at most 231 - 1.</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">A &#x3D; [ 1, 2]</span><br><span class="line">B &#x3D; [-2,-1]</span><br><span class="line">C &#x3D; [-1, 2]</span><br><span class="line">D &#x3D; [ 0, 2]</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">The two tuples are:</span><br><span class="line">1. (0, 0, 0, 1) -&gt; A[0] + B[0] + C[0] + D[1] &#x3D; 1 + (-2) + (-1) + 2 &#x3D; 0</span><br><span class="line">2. (1, 1, 0, 0) -&gt; A[1] + B[1] + C[0] + D[0] &#x3D; 2 + (-1) + (-1) + 0 &#x3D; 0</span><br></pre></td></tr></table></figure>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h3><p>题目是在二分搜索的tag下面的，所以最开始一直局限于怎么往二分查找的方向靠，导致没有做出来。</p>
<p>最暴力的列举法需要$O(n^4)$ 所以排除了。</p>
<p>如果使用哈希表来存储前两个数组AB的组合结果，记录下每个组合的和与对应的和的count，然后对应的把剩下的CD两个数组去计算和，因为前面的两个数组的和记录下在哈希表中了，所以可以直接去寻找是否有-sum(C[k],D[l]如果有的话，加上对应的count得到组合。</p>
<h2 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h2><p>使用两个双重循环，所以复杂度：$O(n^2)$  </p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 304 ms, faster than 45.61% of C++ online submissions for 4Sum II.</span></span><br><span class="line"><span class="comment">Memory Usage: 23 MB, less than 95.45% of C++ online submissions for 4Sum II.</span></span><br><span class="line"><span class="comment">不用条件语句</span></span><br><span class="line"><span class="comment">Runtime: 248 ms, faster than 71.92% of C++ online submissions for 4Sum II.</span></span><br><span class="line"><span class="comment">Memory Usage: 23.2 MB, less than 95.45% of C++ online submissions for 4Sum II.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">fourSumCount</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; A, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; B, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; C, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; D)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="built_in">map</span>;</span><br><span class="line">		<span class="keyword">int</span> rtn = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">				<span class="keyword">int</span> sum = A[i] + B[j];</span><br><span class="line">				<span class="comment">// if (map.count(sum)) map[sum]++;</span></span><br><span class="line">				<span class="comment">// else map[sum] = 1;</span></span><br><span class="line">				<span class="built_in">map</span>[sum]++;<span class="comment">// 默认初始的值为0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++ ) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; n; l++) &#123;</span><br><span class="line">				<span class="keyword">int</span> sum = C[k] + D[l];</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">map</span>.count(-sum)) rtn += <span class="built_in">map</span>[-sum];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rtn;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>www.github.com/azl397985856/leetcode/blob/master/problems/454.4-sum-ii.md</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-16-leetcode-287-Find-the-Duplicate-Number.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-16-leetcode-287-Find-the-Duplicate-Number.html" class="post-title-link" itemprop="url">leetcode 287 Find the Duplicate Number</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-16 22:43:49" itemprop="dateCreated datePublished" datetime="2020-04-16T22:43:49+08:00">2020-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-17 21:54:39" itemprop="dateModified" datetime="2020-04-17T21:54:39+08:00">2020-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index">
                    <span itemprop="name">题解</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-16-leetcode-287-Find-the-Duplicate-Number.html" class="post-meta-item leancloud_visitors" data-flag-title="leetcode 287 Find the Duplicate Number" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-16-leetcode-287-Find-the-Duplicate-Number.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-16-leetcode-287-Find-the-Duplicate-Number.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="leetcode-287-Find-the-Duplicate-Number"><a href="#leetcode-287-Find-the-Duplicate-Number" class="headerlink" title="leetcode 287 Find the Duplicate Number"></a>leetcode 287 Find the Duplicate Number</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://leetcode.com/problems/find-the-duplicate-number/" target="_blank" rel="noopener">题目链接</a>,寻找一个数组中的重复值。</p>
<p>Given an array <em>nums</em> containing <em>n</em> + 1 integers where each integer is between 1 and <em>n</em> (inclusive), prove that at least one duplicate number must exist. Assume that there is only one duplicate number, find the duplicate one.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,3,4,2,2]</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,1,3,4,2]</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ol>
<li>You <strong>must not</strong> modify the array (assume the array is read only).</li>
<li>You must use only constant, <em>O</em>(1) extra space.</li>
<li>Your runtime complexity should be less than $O(n^2)$.</li>
<li>There is only one duplicate number in the array, but it could be repeated more than once.</li>
</ol>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="二分搜索"><a href="#二分搜索" class="headerlink" title="二分搜索"></a>二分搜索</h3><p>题目给出了数组中对数字大小的限制，从这点出发，假设数组没有重复，并且按照顺序排序的话，则可以从1排到n+1。但是因为题目要求最多排到n，所以最后一个n+1一定要换成k，而$1\le k\le n$所以一定会与前n个值产生重复。</p>
<p>当产生重复以后从k到n的元素有：小于等于其值的个数一定会大于其本身，即满足$A[i] \le A[k]$ 的i的个数有$count(A[i])\ge k$ 。这样只用寻找到满足前面条件的最小的i,就找到重复值了。</p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587131587/blog/coding/lc287_1.jpg" alt=""></p>
<p>使用二分搜索来进行查找，如果小于中间值的个数等于中间值，说明左半部分没有重复值，向右边寻找。否则向左边寻找，直到找到最小值。</p>
<h3 id="链表找环"><a href="#链表找环" class="headerlink" title="链表找环"></a>链表找环</h3><p>索引从0开始，得到A[0]的值，然后将A[0]的值作为新的索引去寻找一个索引，按照这样的规则形成一个链表，因为一定有重复的值，相当于同一个索引会被指向两次，因此会形成环。过程如下所示： </p>
<p><img src="https://res.cloudinary.com/bravey/image/upload/v1587131587/blog/coding/lc287_2.jpg" alt=""></p>
<p>链表中找环，可以使用快慢指针的方法。</p>
<p>快慢指针同时从0索引开始移动，慢指针每次移动一步，快指针每次移动两步，这样快指针就会先进入环中，然后一直在环里面移动，直到慢指针也进入环中，然后二者第一次相遇。</p>
<p>当两个指针相遇后，让快指针停止移动，然后新用一个指针从头开始移动。慢指针和新指针都是一次移动一步，当慢指针和新指针再次相遇时，到达环的入口也就是，重复的值。</p>
<h3 id="数学解释"><a href="#数学解释" class="headerlink" title="数学解释"></a>数学解释</h3><p><img src="https://res.cloudinary.com/bravey/image/upload/v1587131587/blog/coding/lc287_3.jpg" alt=""></p>
<p>设环前面的长度为a，快慢指针的相遇点距离环的起点距离为b，剩下的距离为c。</p>
<p>则快慢指针相遇时，慢指针走的路程是：$a+b$, 快指针走的路程是$a+k(b+c)+b$ ，$k(b+c)$ 指的是快指针已经在环中走过k圈。因为快指针的速度是慢指针的两倍，所以快指针走过的路程是慢指针的两倍，因此有等式$2(a+b)=a+(k-1)(b+c)+b$ 化简后得到$a = (k-1)b + kc$ 因此这个时候再走a的距离就会回到起点。</p>
<p>所以新指针与慢指针会相遇到环的起点。</p>
<h2 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h2><h3 id="二分搜索-1"><a href="#二分搜索-1" class="headerlink" title="二分搜索"></a>二分搜索</h3><p>二分搜索，树的高度是$O(log(n))$ ，每次统计count需要$O(n)$,因此总共的时间复杂度是$O(nlog(n))$ </p>
<h3 id="链表找环-1"><a href="#链表找环-1" class="headerlink" title="链表找环"></a>链表找环</h3><p>使用两个循环，因此复杂度是$O(n)$.</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="　代码"></a>　代码</h2><p><a href="https://github.com/BraveY/Coding/blob/master/leetcode/287find-the-duplicate-number.cc" target="_blank" rel="noopener">完整代码地址</a></p>
<h3 id="二分搜索-2"><a href="#二分搜索-2" class="headerlink" title="二分搜索"></a>二分搜索</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 12 ms, faster than 60.68% of C++ online submissions for Find the Duplicate Number.</span></span><br><span class="line"><span class="comment">Memory Usage: 7.6 MB, less than 100.00% of C++ online submissions for Find the Duplicate Number.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution1</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> r = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            <span class="keyword">int</span> m = (r - l) / <span class="number">2</span> + l;</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">// len(nums &lt;= m)</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> num : nums)</span><br><span class="line">                <span class="keyword">if</span> (num &lt;= m) ++count;</span><br><span class="line">            <span class="keyword">if</span> (count &lt;= m)</span><br><span class="line">                l = m + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                r = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="链表找环-2"><a href="#链表找环-2" class="headerlink" title="链表找环"></a>链表找环</h3><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution3</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//最开始的index是从0开始的</span></span><br><span class="line">        <span class="keyword">int</span> slow = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> fast = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">            fast = nums[nums[fast]];</span><br><span class="line">            <span class="keyword">if</span> (slow == fast) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">find</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">find</span> != slow) &#123;</span><br><span class="line">            <span class="built_in">find</span> = nums[<span class="built_in">find</span>];</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">find</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/72886883" target="_blank" rel="noopener">leetcode算法汇总 （三）快慢指针 - mercury的文章 - 知乎</a></p>
<p><a href="https://zxi.mytechroad.com/blog/algorithms/binary-search/leetcode-287-find-the-duplicate-number/" target="_blank" rel="noopener">花花leetcode</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-10-Linux%E8%BF%90%E7%BB%B4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-10-Linux%E8%BF%90%E7%BB%B4.html" class="post-title-link" itemprop="url">Linux运维</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-10 10:24:39 / 修改时间：14:50:16" itemprop="dateCreated datePublished" datetime="2020-04-10T10:24:39+08:00">2020-04-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-10-Linux%E8%BF%90%E7%BB%B4.html" class="post-meta-item leancloud_visitors" data-flag-title="Linux运维" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-10-Linux%E8%BF%90%E7%BB%B4.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-10-Linux运维.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>164</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux运维"><a href="#Linux运维" class="headerlink" title="Linux运维"></a>Linux运维</h1><p>记录在使用Linux过程中遇到的一些问题的解决方式</p>
<p><strong>jupyter lab无权限创建文件</strong></p>
<p><code>chmod 777 file_path</code> 解决</p>
<p><strong>jupyter lab 服务器地址访问被拒绝</strong></p>
<p>启动时加上 —ip=0.0.0.0</p>
<p><code>jupyter lab --port=8889 --ip=0.0.0.0</code></p>
<p><strong>zip文件解压</strong></p>
<p><code>unzip file -d outputdir</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bravey.github.io/2020-04-02-leetcode-4-Median-of-Two-Sorted-Arrays.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
      <meta itemprop="name" content="BraveY">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BraveY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020-04-02-leetcode-4-Median-of-Two-Sorted-Arrays.html" class="post-title-link" itemprop="url">leetcode 4 Median of Two Sorted Arrays</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-02 20:40:12 / 修改时间：21:31:56" itemprop="dateCreated datePublished" datetime="2020-04-02T20:40:12+08:00">2020-04-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index">
                    <span itemprop="name">题解</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020-04-02-leetcode-4-Median-of-Two-Sorted-Arrays.html" class="post-meta-item leancloud_visitors" data-flag-title="leetcode 4 Median of Two Sorted Arrays" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020-04-02-leetcode-4-Median-of-Two-Sorted-Arrays.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020-04-02-leetcode-4-Median-of-Two-Sorted-Arrays.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>542</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://leetcode.com/problems/median-of-two-sorted-arrays/" target="_blank" rel="noopener">题目链接</a>要求求出两个有序数组的总的中位数，但是时间复杂度限制在了$log(m+n)$</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="双指针"><a href="#双指针" class="headerlink" title="双指针"></a>双指针</h3><p>首先最容易想到的方法是采用归并排序中的一个小步骤，使用双指针将两个数组合并后直接可以给出中位数，中间还可以进行计数只用选择到$(m+n)/2$个数字就可以了。这样的方法思路很简单，写起来也很容易，复杂度为$O(m+n)$ 不符合题意，所以跳过。</p>
<h3 id="二分搜索"><a href="#二分搜索" class="headerlink" title="二分搜索"></a>二分搜索</h3><p>中位数的位置如果是奇数的话是$(m+n+1)/2$记为k,如果是偶数的话则是k和k+1对应的两数之和的均值，这是<strong>第一个条件</strong>。</p>
<p><strong>第二个条件</strong>则是二分搜索里面的用来比较的条件：左半部分的最大值小于右半部分的最小值。</p>
<p>左半部分中，第一个数组参与了m1个，第二个数组参与了m2个，并且把第一个数组的长度认为小于第二个数组（如果相反，交换下参数的位置即可）。</p>
<p>为了满足第一个条件，即让左半部分的长度为一半的长度，有m1+m2 = k 。这样只用针对第一个数组进行二分就可以了，有了m1的值m2的值自然也确定了。自己之前想的是两个数组都进行二分就没有想出来。</p>
<p>第二个条件需要稍微在转换下，因为左半部分的值最大值是max(nums1[m1-1],nums2[m2-1]),右半部分的最小值是min(nums1[m1],nums2[m2]) 所以分别让</p>
<script type="math/tex; mode=display">
nums1[m1-1]<=nums2[m2],nums2[m2-1]<=nums1[m1]</script><p>就可以满足第二个条件了。</p>
<p>这样通过在长度较小的第一个数组中进行二分直到找到符合第二个条件的m1的值就可以输出中位数了。</p>
<p>如果是奇数：max(nums1[m1-1],nums2[m2-1])，如果是偶数(max(nums1[m1-1],nums2[m2-1])+min(nums1[m1],nums2[m2]) )/2。</p>
<h3 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h3><p>O(log(min(m,n))) </p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>判断条件:</p>
<script type="math/tex; mode=display">
nums1[m1-1]<=nums2[m2],nums2[m2-1]<=nums1[m1]</script><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Runtime: 20 ms, faster than 66.18% of C++ online submissions for Median of Two Sorted Arrays.</span></span><br><span class="line"><span class="comment">Memory Usage: 7.2 MB, less than 100.00% of C++ online submissions for Median of Two Sorted Arrays.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution2</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> n1 = nums1.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> n2 = nums2.<span class="built_in">size</span>();</span><br><span class="line">		<span class="comment">// make sure n1 &lt; n2, by swapping</span></span><br><span class="line">		<span class="keyword">if</span> (n1 &gt; n2) <span class="keyword">return</span> findMedianSortedArrays(nums2, nums1);</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> k = (n1 + n2 + <span class="number">1</span>) / <span class="number">2</span> ;</span><br><span class="line">		<span class="keyword">int</span> l = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> r = n1;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> m1 = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> m2 = k - m1;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> maxLeftA = m1 &lt;= <span class="number">0</span> ? INT_MIN : nums1[m1 - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> minRightA = m1 &gt;= n1 ? INT_MAX : nums1[m1];</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> maxLeftB = m2 &lt;= <span class="number">0</span> ? INT_MIN : nums2[m2 - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> minRightB = m2 &gt;= n2 ? INT_MAX : nums2[m2];</span><br><span class="line">			<span class="keyword">if</span> (maxLeftA &lt; minRightB &amp;&amp; maxLeftB &lt;= minRightA) &#123;</span><br><span class="line">				<span class="comment">// cout &lt;&lt; l &lt;&lt; "	" &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">				<span class="keyword">if</span> ((n1 + n2) % <span class="number">2</span> == <span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">max</span>(maxLeftA, maxLeftB);</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">return</span> (<span class="built_in">max</span>(maxLeftB, maxLeftA) + <span class="built_in">min</span>(minRightB, minRightA)) * <span class="number">0.5</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (nums1[m1] &lt; nums2[m2 - <span class="number">1</span>])</span><br><span class="line">				l = m1 + <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				r = m1 - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>还有一种代码更简洁的，其方法的条件是寻找maxLeftA&gt;= minRightB的最小的m1值，也就是尽可能的找到二者之间差最小的。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">huahua</span></span><br><span class="line"><span class="comment">Runtime: 20 ms, faster than 66.18% of C++ online submissions for Median of Two Sorted Arrays.</span></span><br><span class="line"><span class="comment">Memory Usage: 7.3 MB, less than 100.00% of C++ online submissions for Median of Two Sorted Arrays.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution1</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> n1 = nums1.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> n2 = nums2.<span class="built_in">size</span>();</span><br><span class="line">		<span class="comment">// make sure n1 &lt; n2, by swapping</span></span><br><span class="line">		<span class="keyword">if</span> (n1 &gt; n2) <span class="keyword">return</span> findMedianSortedArrays(nums2, nums1);</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> k = (n1 + n2 + <span class="number">1</span>) / <span class="number">2</span> ;</span><br><span class="line">		<span class="keyword">int</span> l = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> r = n1;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> m1 = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> m2 = k - m1;</span><br><span class="line">			<span class="comment">// 寻找最小的m1满足 maxLeftA &gt;= minRightB</span></span><br><span class="line">			<span class="keyword">if</span> (nums1[m1] &lt; nums2[m2 - <span class="number">1</span>])</span><br><span class="line">				l = m1 + <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				r = m1;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// cout &lt;&lt; l &lt;&lt; "	" &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> m1 = l;</span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> m2 = k - m1;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> c1 = <span class="built_in">max</span>(m1 &lt;= <span class="number">0</span> ? INT_MIN : nums1[m1 - <span class="number">1</span>],</span><br><span class="line">		                   m2 &lt;= <span class="number">0</span> ? INT_MIN : nums2[m2 - <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ((n1 + n2) % <span class="number">2</span> == <span class="number">1</span>) <span class="keyword">return</span> c1;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> <span class="keyword">int</span> c2 = <span class="built_in">min</span>(m1 &gt;= n1 ? INT_MAX : nums1[m1],</span><br><span class="line">		                   m2 &gt;= n2 ? INT_MAX : nums2[m2]);</span><br><span class="line">		<span class="keyword">return</span> (c1 + c2) * <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>两种基本一致，有个小细节：</p>
<p>如果二分的时候退出条件是l&lt;r 那么只用移动左边中值加1，右边移动时移动到中值而不是中值减1.</p>
<p>如果循环退出条件时l&lt;=r，那么两边移动左边中值加1，右边中值减1.</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/39129143" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/39129143</a> </p>
<p><a href="https://zxi.mytechroad.com/blog/algorithms/binary-search/leetcode-4-median-of-two-sorted-arrays/" target="_blank" rel="noopener">https://zxi.mytechroad.com/blog/algorithms/binary-search/leetcode-4-median-of-two-sorted-arrays/</a> </p>
<p><a href="https://github.com/azl397985856/leetcode/blob/master/problems/4.median-of-two-sorted-array.md" target="_blank" rel="noopener">https://github.com/azl397985856/leetcode/blob/master/problems/4.median-of-two-sorted-array.md</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="BraveY"
      src="http://imgsrc.baidu.com/forum/w%3D580/sign=9ef55a639e22720e7bcee2f24bcb0a3a/072032adcbef7609dc34669e28dda3cc7dd99ecc.jpg">
  <p class="site-author-name" itemprop="name">BraveY</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/BraveY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;BraveY" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kaiyongyang@gmail.com" title="E-Mail → mailto:kaiyongyang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/yang-shan-zhi-14" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yang-shan-zhi-14" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_33620071" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_33620071" rel="noopener" target="_blank"><i class="fa fa-fw fa-copyright"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BraveY</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">224k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:23</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>

<span id="sitetime"></span>
<script language=javascript>
  function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000;
    var minutes = seconds * 60;
    var hours = minutes * 60;
    var days = hours * 24;
    var years = days * 365;
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
    year - 作为date对象的年份，为4位年份值
    month - 0-11之间的整数，做为date对象的月份
    day - 1-31之间的整数，做为date对象的天数
    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
    minutes - 0-59之间的整数，做为date对象的分钟数
    seconds - 0-59之间的整数，做为date对象的秒数
    microseconds - 0-999之间的整数，做为date对象的毫秒数 */
    var t1 = Date.UTC(2018,04,17,17,36,03); //北京时间2018-4-17 17:36:03
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = t2-t1;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
    document.getElementById("sitetime").innerHTML=" 已运行"+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
  }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
  siteTime();
</script>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.log('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=W6nLzKg0cpOi9OkACkaXg3YB-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'W6nLzKg0cpOi9OkACkaXg3YB-gzGzoHsz',
            'X-LC-Key': '0M7O0e3b6oEuphDr3yhQLx3E',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>














  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://bravey.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
